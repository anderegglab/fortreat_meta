geom_line(data = pdata[pdata$disturbance_type == "insect",], aes(x = map, y = mean, color = disturbance_type), size = 3) +
geom_point(data = data[data$disturbance_type == "insect" & data$carbon_vs_mortality == 2,], aes(x = map, y = lrr, color = disturbance_type), size = 5) +
ggtitle("Insect") +
scale_x_continuous(limits = c(min(pdata$map), max(pdata$map)), expand = c(0,0)) +
scale_y_continuous(limits = c(-2, 5), expand = c(0,0)) +
scale_color_manual(values = c(yellow)) +
scale_fill_manual(values = c(yellow)) +
theme_bw() +
theme(legend.position = "none", axis.title = element_blank(),
plot.title = element_text(face = "bold", size = 18),
panel.grid = element_blank())
p3
p1 + p2 + p3 +
plot_layout(
design = "ABC")
#ggsave("figures/figure7E.png", width = 10, height = 4)
#ggsave("figures/illustrator/figure7E.pdf", width = 10, height = 4)
## Carbon
carbon_sev_imputed <- impute_data(data[data$carbon_vs_mortality == 1,], m = 100)
carbon_fit <- with(carbon_sev_imputed,
rma(yi = lrr,
sei = lrr_se,
mods = ~ 0 + map * disturbance_type))
pool_carbon <- summary(pool(carbon_fit))
pool_carbon[-1] <- round(pool_carbon[-1], digits = 4)
pool_carbon
table_gen(pool_carbon, "map_carbon.csv")
## mortality
pd <- data.frame(disturbance_typefire = c(rep(1, times = 20), rep(0, times = 40)),
disturbance_typedrought = c(rep(0, times = 20), rep(1, times = 20), rep(0, times = 20)),
disturbance_typeinsect = c(rep(0, times = 40), rep(1, times = 20)),
map = c(rep(0, times = 20), seq(-2, 3, length.out = 20), rep(0, times = 20)),
mapdisturbance_typefire = c(seq(-2, 3, length.out = 20), rep(0, times = 40)),
mapdisturbance_typeinsect = c(rep(0, times = 40), seq(-2, 3, length.out = 20)))
colnames(pd)[5] <- "map:disturbance_typefire"
colnames(pd)[6] <- "map:disturbance_typeinsect"
out <- list(mean = matrix(nrow = 60, ncol = 100), ci.lb = matrix(nrow = 60, ncol = 100), ci.ub = matrix(nrow = 60, ncol = 100))
for (i in 1:100) {
p <- predict.rma(carbon_fit$analyses[[i]], newmods = as.matrix(pd))
out[[1]][,i] <- p[[1]]
out[[2]][,i] <- p[[3]]
out[[3]][,i] <- p[[4]]
}
pdata <- data.frame(disturbance_type = factor(rep(c("fire", "drought", "insect"), each = 20), levels = c("fire", "drought", "insect")),
map = rep(seq(-2, 3, length.out = 20), times = 3))
pdata$mean <- rowMeans(out[[1]])
pdata$lower <- rowMeans(out[[2]])
pdata$upper <- rowMeans(out[[3]])
pdata$map <- pdata$map * sd(data$map) + mean(data$map)
p4 <- ggplot() +
geom_hline(yintercept = 0, color = "black", size = 2) +
geom_ribbon(data = pdata[pdata$disturbance_type == "fire",], aes(x = map, ymin = lower, ymax = upper, fill = disturbance_type), alpha = 0.3) +
geom_line(data = pdata[pdata$disturbance_type == "fire",], aes(x = map, y = mean, color = disturbance_type), size = 3) +
geom_point(data = data[data$disturbance_type == "fire" & data$carbon_vs_mortality == 1,], aes(x = map, y = lrr, color = disturbance_type), size = 5) +
scale_x_continuous(limits = c(min(pdata$map), max(pdata$map)), expand = c(0,0)) +
scale_y_continuous(limits = c(-4,3), expand = c(0,0)) +
ylab("Log Response Ratio") +
ggtitle("Fire") +
scale_color_manual(values = c(red)) +
scale_fill_manual(values = c(red)) +
theme_bw() +
theme(legend.position = "none", axis.title.x = element_blank(), axis.title.y = element_text(size = 16),
plot.title = element_text(face = "bold", size = 18),
panel.grid = element_blank())
p4
p5 <- ggplot() +
geom_hline(yintercept = 0, color = "black", size = 2) +
geom_ribbon(data = pdata[pdata$disturbance_type == "drought",], aes(x = map, ymin = lower, ymax = upper, fill = disturbance_type), alpha = 0.3) +
geom_line(data = pdata[pdata$disturbance_type == "drought",], aes(x = map, y = mean, color = disturbance_type), size = 3) +
geom_point(data = data[data$disturbance_type == "drought" & data$carbon_vs_mortality == 1,], aes(x = map, y = lrr, color = disturbance_type), size = 5) +
ggtitle("Drought") +
xlab("Mean Annual Precipitation") +
scale_x_continuous(limits = c(min(pdata$map), max(pdata$map)), expand = c(0,0)) +
scale_y_continuous(limits = c(-4, 3), expand = c(0,0)) +
scale_color_manual(values = c(blue)) +
scale_fill_manual(values = c(blue)) +
theme_bw() +
theme(legend.position = "none", axis.title.x = element_text(size = 16), axis.title.y = element_blank(),
plot.title = element_text(face = "bold", size = 18),
panel.grid = element_blank())
p5
p6 <- ggplot() +
geom_hline(yintercept = 0, color = "black", size = 2) +
geom_ribbon(data = pdata[pdata$disturbance_type == "insect",], aes(x = map, ymin = lower, ymax = upper, fill = disturbance_type), alpha = 0.3) +
geom_line(data = pdata[pdata$disturbance_type == "insect",], aes(x = map, y = mean, color = disturbance_type), size = 3) +
geom_point(data = data[data$disturbance_type == "insect" & data$carbon_vs_mortality == 1,], aes(x = map, y = lrr, color = disturbance_type), size = 5) +
ggtitle("Insect") +
#annotate("text", y = 2.5, x = 18, label = "*", size = 15) +
scale_x_continuous(limits = c(min(pdata$map), max(pdata$map)), expand = c(0,0)) +
scale_y_continuous(limits = c(-4, 3), expand = c(0,0)) +
scale_color_manual(values = c(yellow)) +
scale_fill_manual(values = c(yellow)) +
theme_bw() +
theme(legend.position = "none", axis.title = element_blank(),
plot.title = element_text(face = "bold", size = 18),
panel.grid = element_blank())
p6
p4 + p5 + p6 +
plot_layout(
design = "ABC")
p1 + p2 + p3 + p4 + p5 + p6 +
plot_layout(
design = "ABC
DEF")
p4 <- ggplot() +
geom_hline(yintercept = 0, color = "black", size = 2) +
geom_ribbon(data = pdata[pdata$disturbance_type == "fire",], aes(x = map, ymin = lower, ymax = upper, fill = disturbance_type), alpha = 0.3) +
geom_line(data = pdata[pdata$disturbance_type == "fire",], aes(x = map, y = mean, color = disturbance_type), size = 3) +
geom_point(data = data[data$disturbance_type == "fire" & data$carbon_vs_mortality == 1,], aes(x = map, y = lrr, color = disturbance_type), size = 5) +
scale_x_continuous(limits = c(min(pdata$map), max(pdata$map)), expand = c(0,0)) +
scale_y_continuous(limits = c(-3,3), expand = c(0,0)) +
ylab("Log Response Ratio") +
ggtitle("Fire") +
scale_color_manual(values = c(red)) +
scale_fill_manual(values = c(red)) +
theme_bw() +
theme(legend.position = "none", axis.title.x = element_blank(), axis.title.y = element_text(size = 16),
plot.title = element_text(face = "bold", size = 18),
panel.grid = element_blank())
p4
p5 <- ggplot() +
geom_hline(yintercept = 0, color = "black", size = 2) +
geom_ribbon(data = pdata[pdata$disturbance_type == "drought",], aes(x = map, ymin = lower, ymax = upper, fill = disturbance_type), alpha = 0.3) +
geom_line(data = pdata[pdata$disturbance_type == "drought",], aes(x = map, y = mean, color = disturbance_type), size = 3) +
geom_point(data = data[data$disturbance_type == "drought" & data$carbon_vs_mortality == 1,], aes(x = map, y = lrr, color = disturbance_type), size = 5) +
ggtitle("Drought") +
xlab("Mean Annual Precipitation") +
scale_x_continuous(limits = c(min(pdata$map), max(pdata$map)), expand = c(0,0)) +
scale_y_continuous(limits = c(-3, 3), expand = c(0,0)) +
scale_color_manual(values = c(blue)) +
scale_fill_manual(values = c(blue)) +
theme_bw() +
theme(legend.position = "none", axis.title.x = element_text(size = 16), axis.title.y = element_blank(),
plot.title = element_text(face = "bold", size = 18),
panel.grid = element_blank())
p5
p6 <- ggplot() +
geom_hline(yintercept = 0, color = "black", size = 2) +
geom_ribbon(data = pdata[pdata$disturbance_type == "insect",], aes(x = map, ymin = lower, ymax = upper, fill = disturbance_type), alpha = 0.3) +
geom_line(data = pdata[pdata$disturbance_type == "insect",], aes(x = map, y = mean, color = disturbance_type), size = 3) +
geom_point(data = data[data$disturbance_type == "insect" & data$carbon_vs_mortality == 1,], aes(x = map, y = lrr, color = disturbance_type), size = 5) +
ggtitle("Insect") +
#annotate("text", y = 2.5, x = 18, label = "*", size = 15) +
scale_x_continuous(limits = c(min(pdata$map), max(pdata$map)), expand = c(0,0)) +
scale_y_continuous(limits = c(-3, 3), expand = c(0,0)) +
scale_color_manual(values = c(yellow)) +
scale_fill_manual(values = c(yellow)) +
theme_bw() +
theme(legend.position = "none", axis.title = element_blank(),
plot.title = element_text(face = "bold", size = 18),
panel.grid = element_blank())
p6
p4 + p5 + p6 +
plot_layout(
design = "ABC")
p1 + p2 + p3 + p4 + p5 + p6 +
plot_layout(
design = "ABC
DEF")
ggsave("figures/illustrator/figure7C.pdf", width = 10, height = 8)
impute_data <- function(data, vars = c("lrr", "lrr_se", "vpd", "disturbance_type"), m = 20) {
mice_data <- data[,vars]
mice_data$vpd <- as.numeric(scale(mice_data$vpd))
mice_data <- cbind(mice_data, vpd.dist = 0)
## make predictor vpdrix
predictor_matrix <- make.predictorMatrix(mice_data)
predictor_matrix ## looks good
impute_method <- make.method(mice_data)
impute_method ## no method specified for complete variables
x <- mice(mice_data, max = 0)
meth <- x$meth
meth["vpd.dist"] <- "~I(vpd*disturbance_type)"
pred <- x$pred
pred[c("vpd", "disturbance_type"), c("vpd.dist")] <- 0
imputed_data <- mice(mice_data, meth = meth, pred = pred, maxit = 40, seed = 1, m = 100)
return(imputed_data)
}
## Mortality
mort_vpd_imputed <- impute_data(data[data$carbon_vs_mortality == 2,], m = 100)
mort_fit <- with(mort_vpd_imputed,
rma(yi = lrr,
sei = lrr_se,
mods = ~ 0 + vpd * disturbance_type))
pool_mort <- summary(pool(mort_fit))
pool_mort[-1] <- round(pool_mort[-1], digits = 4)
pool_mort
table_gen(pool_mort, "vpd_mort.csv")
## mortality
pd <- data.frame(disturbance_typefire = c(rep(1, times = 20), rep(0, times = 40)),
disturbance_typedrought = c(rep(0, times = 20), rep(1, times = 20), rep(0, times = 20)),
disturbance_typeinsect = c(rep(0, times = 40), rep(1, times = 20)),
vpd = c(rep(0, times = 20), seq(-2, 3, length.out = 20), rep(0, times = 20)),
vpddisturbance_typefire = c(seq(-2, 3, length.out = 20), rep(0, times = 40)),
vpddisturbance_typeinsect = c(rep(0, times = 40), seq(-2, 3, length.out = 20)))
colnames(pd)[5] <- "vpd:disturbance_typefire"
colnames(pd)[6] <- "vpd:disturbance_typeinsect"
out <- list(mean = matrix(nrow = 60, ncol = 100), ci.lb = matrix(nrow = 60, ncol = 100), ci.ub = matrix(nrow = 60, ncol = 100))
for (i in 1:100) {
p <- predict.rma(mort_fit$analyses[[i]], newmods = as.matrix(pd))
out[[1]][,i] <- p[[1]]
out[[2]][,i] <- p[[3]]
out[[3]][,i] <- p[[4]]
}
pdata <- data.frame(disturbance_type = factor(rep(c("fire", "drought", "insect"), each = 20), levels = c("fire", "drought", "insect")),
vpd = rep(seq(-2, 3, length.out = 20), times = 3))
pdata$mean <- rowMeans(out[[1]])
pdata$lower <- rowMeans(out[[2]])
pdata$upper <- rowMeans(out[[3]])
pdata$vpd <- pdata$vpd * sd(data$vpd) + mean(data$vpd)
p1 <- ggplot() +
geom_hline(yintercept = 0, color = "black", size = 2) +
geom_ribbon(data = pdata[pdata$disturbance_type == "fire",], aes(x = vpd, ymin = lower, ymax = upper, fill = disturbance_type), alpha = 0.3) +
geom_line(data = pdata[pdata$disturbance_type == "fire",], aes(x = vpd, y = mean, color = disturbance_type), size = 3) +
geom_point(data = data[data$disturbance_type == "fire" & data$carbon_vs_mortality == 2,], aes(x = vpd, y = lrr, color = disturbance_type), size = 5) +
scale_x_continuous(limits = c(min(pdata$vpd), max(pdata$vpd)), expand = c(0,0)) +
scale_y_continuous(limits = c(-1,5), expand = c(0,0)) +
ylab("Log Response Ratio") +
ggtitle("Fire") +
scale_color_manual(values = c(red)) +
scale_fill_manual(values = c(red)) +
theme_bw() +
theme(legend.position = "none", axis.title.x = element_blank(), axis.title.y = element_text(size = 16),
plot.title = element_text(face = "bold", size = 18),
panel.grid = element_blank())
p1
p2 <- ggplot() +
geom_hline(yintercept = 0, color = "black", size = 2) +
geom_ribbon(data = pdata[pdata$disturbance_type == "drought",], aes(x = vpd, ymin = lower, ymax = upper, fill = disturbance_type), alpha = 0.3) +
geom_line(data = pdata[pdata$disturbance_type == "drought",], aes(x = vpd, y = mean, color = disturbance_type), size = 3) +
geom_point(data = data[data$disturbance_type == "drought" & data$carbon_vs_mortality == 2,], aes(x = vpd, y = lrr, color = disturbance_type), size = 5) +
ggtitle("Drought") +
xlab("Vapor Pressure Deficit") +
scale_x_continuous(limits = c(min(pdata$vpd), max(pdata$vpd)), expand = c(0,0)) +
scale_y_continuous(limits = c(-1, 5), expand = c(0,0)) +
scale_color_manual(values = c(blue)) +
scale_fill_manual(values = c(blue)) +
theme_bw() +
theme(legend.position = "none", axis.title.x = element_text(size = 16), axis.title.y = element_blank(),
plot.title = element_text(face = "bold", size = 18),
panel.grid = element_blank())
p2
p3 <- ggplot() +
geom_hline(yintercept = 0, color = "black", size = 2) +
geom_ribbon(data = pdata[pdata$disturbance_type == "insect",], aes(x = vpd, ymin = lower, ymax = upper, fill = disturbance_type), alpha = 0.3) +
geom_line(data = pdata[pdata$disturbance_type == "insect",], aes(x = vpd, y = mean, color = disturbance_type), size = 3) +
geom_point(data = data[data$disturbance_type == "insect" & data$carbon_vs_mortality == 2,], aes(x = vpd, y = lrr, color = disturbance_type), size = 5) +
ggtitle("Insect") +
scale_x_continuous(limits = c(min(pdata$vpd), max(pdata$vpd)), expand = c(0,0)) +
scale_y_continuous(limits = c(-1, 5), expand = c(0,0)) +
scale_color_manual(values = c(yellow)) +
scale_fill_manual(values = c(yellow)) +
theme_bw() +
theme(legend.position = "none", axis.title = element_blank(),
plot.title = element_text(face = "bold", size = 18),
panel.grid = element_blank())
p3
p1 + p2 + p3 +
plot_layout(
design = "ABC")
## Carbon
carbon_sev_imputed <- impute_data(data[data$carbon_vs_mortality == 1,], m = 100)
carbon_fit <- with(carbon_sev_imputed,
rma(yi = lrr,
sei = lrr_se,
mods = ~ 0 + vpd * disturbance_type))
pool_carbon <- summary(pool(carbon_fit))
pool_carbon[-1] <- round(pool_carbon[-1], digits = 4)
pool_carbon
table_gen(pool_carbon, "vpd_carbon.csv")
## mortality
pd <- data.frame(disturbance_typefire = c(rep(1, times = 20), rep(0, times = 40)),
disturbance_typedrought = c(rep(0, times = 20), rep(1, times = 20), rep(0, times = 20)),
disturbance_typeinsect = c(rep(0, times = 40), rep(1, times = 20)),
vpd = c(rep(0, times = 20), seq(-2, 3, length.out = 20), rep(0, times = 20)),
vpddisturbance_typefire = c(seq(-2, 3, length.out = 20), rep(0, times = 40)),
vpddisturbance_typeinsect = c(rep(0, times = 40), seq(-2, 3, length.out = 20)))
colnames(pd)[5] <- "vpd:disturbance_typefire"
colnames(pd)[6] <- "vpd:disturbance_typeinsect"
out <- list(mean = matrix(nrow = 60, ncol = 100), ci.lb = matrix(nrow = 60, ncol = 100), ci.ub = matrix(nrow = 60, ncol = 100))
for (i in 1:100) {
p <- predict.rma(carbon_fit$analyses[[i]], newmods = as.matrix(pd))
out[[1]][,i] <- p[[1]]
out[[2]][,i] <- p[[3]]
out[[3]][,i] <- p[[4]]
}
pdata <- data.frame(disturbance_type = factor(rep(c("fire", "drought", "insect"), each = 20), levels = c("fire", "drought", "insect")),
vpd = rep(seq(-2, 3, length.out = 20), times = 3))
pdata$mean <- rowMeans(out[[1]])
pdata$lower <- rowMeans(out[[2]])
pdata$upper <- rowMeans(out[[3]])
pdata$vpd <- pdata$vpd * sd(data$vpd) + mean(data$vpd)
p4 <- ggplot() +
geom_hline(yintercept = 0, color = "black", size = 2) +
geom_ribbon(data = pdata[pdata$disturbance_type == "fire",], aes(x = vpd, ymin = lower, ymax = upper, fill = disturbance_type), alpha = 0.3) +
geom_line(data = pdata[pdata$disturbance_type == "fire",], aes(x = vpd, y = mean, color = disturbance_type), size = 3) +
geom_point(data = data[data$disturbance_type == "fire" & data$carbon_vs_mortality == 1,], aes(x = vpd, y = lrr, color = disturbance_type), size = 5) +
scale_x_continuous(limits = c(min(pdata$vpd), max(pdata$vpd)), expand = c(0,0)) +
scale_y_continuous(limits = c(-5,3), expand = c(0,0)) +
annotate("text", y = 2.5, x = 0.4, label = "*", size = 15) +
ylab("Log Response Ratio") +
ggtitle("Fire") +
scale_color_manual(values = c(red)) +
scale_fill_manual(values = c(red)) +
theme_bw() +
theme(legend.position = "none", axis.title.x = element_blank(), axis.title.y = element_text(size = 16),
plot.title = element_text(face = "bold", size = 18),
panel.grid = element_blank())
p4
p5 <- ggplot() +
geom_hline(yintercept = 0, color = "black", size = 2) +
geom_ribbon(data = pdata[pdata$disturbance_type == "drought",], aes(x = vpd, ymin = lower, ymax = upper, fill = disturbance_type), alpha = 0.3) +
geom_line(data = pdata[pdata$disturbance_type == "drought",], aes(x = vpd, y = mean, color = disturbance_type), size = 3) +
geom_point(data = data[data$disturbance_type == "drought" & data$carbon_vs_mortality == 1,], aes(x = vpd, y = lrr, color = disturbance_type), size = 5) +
ggtitle("Drought") +
xlab("Vapor Pressure Deficit") +
scale_x_continuous(limits = c(min(pdata$vpd), max(pdata$vpd)), expand = c(0,0)) +
scale_y_continuous(limits = c(-5, 3), expand = c(0,0)) +
scale_color_manual(values = c(blue)) +
scale_fill_manual(values = c(blue)) +
theme_bw() +
theme(legend.position = "none", axis.title.x = element_text(size = 16), axis.title.y = element_blank(),
plot.title = element_text(face = "bold", size = 18),
panel.grid = element_blank())
p5
p6 <- ggplot() +
geom_hline(yintercept = 0, color = "black", size = 2) +
geom_ribbon(data = pdata[pdata$disturbance_type == "insect",], aes(x = vpd, ymin = lower, ymax = upper, fill = disturbance_type), alpha = 0.3) +
geom_line(data = pdata[pdata$disturbance_type == "insect",], aes(x = vpd, y = mean, color = disturbance_type), size = 3) +
geom_point(data = data[data$disturbance_type == "insect" & data$carbon_vs_mortality == 1,], aes(x = vpd, y = lrr, color = disturbance_type), size = 5) +
ggtitle("Insect") +
#annotate("text", y = 2.5, x = 0.4, label = "*", size = 15) +
scale_x_continuous(limits = c(min(pdata$vpd), max(pdata$vpd)), expand = c(0,0)) +
scale_y_continuous(limits = c(-5, 3), expand = c(0,0)) +
scale_color_manual(values = c(yellow)) +
scale_fill_manual(values = c(yellow)) +
theme_bw() +
theme(legend.position = "none", axis.title = element_blank(),
plot.title = element_text(face = "bold", size = 18),
panel.grid = element_blank())
p6
p4 + p5 + p6 +
plot_layout(
design = "ABC")
p1 + p2 + p3 + p4 + p5 + p6 +
plot_layout(
design = "ABC
DEF")
p4 <- ggplot() +
geom_hline(yintercept = 0, color = "black", size = 2) +
geom_ribbon(data = pdata[pdata$disturbance_type == "fire",], aes(x = vpd, ymin = lower, ymax = upper, fill = disturbance_type), alpha = 0.3) +
geom_line(data = pdata[pdata$disturbance_type == "fire",], aes(x = vpd, y = mean, color = disturbance_type), size = 3) +
geom_point(data = data[data$disturbance_type == "fire" & data$carbon_vs_mortality == 1,], aes(x = vpd, y = lrr, color = disturbance_type), size = 5) +
scale_x_continuous(limits = c(min(pdata$vpd), max(pdata$vpd)), expand = c(0,0)) +
scale_y_continuous(limits = c(-4,3), expand = c(0,0)) +
annotate("text", y = 2.5, x = 0.4, label = "*", size = 15) +
ylab("Log Response Ratio") +
ggtitle("Fire") +
scale_color_manual(values = c(red)) +
scale_fill_manual(values = c(red)) +
theme_bw() +
theme(legend.position = "none", axis.title.x = element_blank(), axis.title.y = element_text(size = 16),
plot.title = element_text(face = "bold", size = 18),
panel.grid = element_blank())
p4
p5 <- ggplot() +
geom_hline(yintercept = 0, color = "black", size = 2) +
geom_ribbon(data = pdata[pdata$disturbance_type == "drought",], aes(x = vpd, ymin = lower, ymax = upper, fill = disturbance_type), alpha = 0.3) +
geom_line(data = pdata[pdata$disturbance_type == "drought",], aes(x = vpd, y = mean, color = disturbance_type), size = 3) +
geom_point(data = data[data$disturbance_type == "drought" & data$carbon_vs_mortality == 1,], aes(x = vpd, y = lrr, color = disturbance_type), size = 5) +
ggtitle("Drought") +
xlab("Vapor Pressure Deficit") +
scale_x_continuous(limits = c(min(pdata$vpd), max(pdata$vpd)), expand = c(0,0)) +
scale_y_continuous(limits = c(-4, 3), expand = c(0,0)) +
scale_color_manual(values = c(blue)) +
scale_fill_manual(values = c(blue)) +
theme_bw() +
theme(legend.position = "none", axis.title.x = element_text(size = 16), axis.title.y = element_blank(),
plot.title = element_text(face = "bold", size = 18),
panel.grid = element_blank())
p5
p6 <- ggplot() +
geom_hline(yintercept = 0, color = "black", size = 2) +
geom_ribbon(data = pdata[pdata$disturbance_type == "insect",], aes(x = vpd, ymin = lower, ymax = upper, fill = disturbance_type), alpha = 0.3) +
geom_line(data = pdata[pdata$disturbance_type == "insect",], aes(x = vpd, y = mean, color = disturbance_type), size = 3) +
geom_point(data = data[data$disturbance_type == "insect" & data$carbon_vs_mortality == 1,], aes(x = vpd, y = lrr, color = disturbance_type), size = 5) +
ggtitle("Insect") +
#annotate("text", y = 2.5, x = 0.4, label = "*", size = 15) +
scale_x_continuous(limits = c(min(pdata$vpd), max(pdata$vpd)), expand = c(0,0)) +
scale_y_continuous(limits = c(-4, 3), expand = c(0,0)) +
scale_color_manual(values = c(yellow)) +
scale_fill_manual(values = c(yellow)) +
theme_bw() +
theme(legend.position = "none", axis.title = element_blank(),
plot.title = element_text(face = "bold", size = 18),
panel.grid = element_blank())
p6
p4 + p5 + p6 +
plot_layout(
design = "ABC")
p1 + p2 + p3 + p4 + p5 + p6 +
plot_layout(
design = "ABC
DEF")
ggsave("figures/illustrator/figure7D.pdf", width = 10, height = 8)
source("C:/Users/cedri/OneDrive/Dokumente/GitHub/fortreat_meta/code/figures/figure7.r")
## libraries
library("metafor")
library("mice")
library("brms")
library("ggplot2")
library("cowplot")
library("patchwork")
source("code/00_functions.r")
## read data
data <- read.csv("data/processed_data/data_cleaned.csv")
##---------------------------------------------------------------
## 1. Impute missing data and fit models
##---------------------------------------------------------------
data$disturbance_type <- factor(data$disturbance_type, levels = c("fire", "drought", "insect"))
impute_data <- function(data, vars = c("lrr", "lrr_se", "disturbance_type"), m = 20) {
mice_data <- data[,vars]
## make predictor matrix
predictor_matrix <- make.predictorMatrix(mice_data)
predictor_matrix ## looks good
impute_method <- make.method(mice_data)
impute_method ## no method specified for complete variables
imputed_data <- mice(mice_data, method = impute_method, predictorMatrix = predictor_matrix,
maxit = 40, seed = 1, m = m)
return(imputed_data)
}
mort_imputed_tcon <- impute_data(data[data$Olson_Biome == "Temperate Conifer Forests" & data$carbon_vs_mortality == 2,], m = 100)
mort_fit_tcon <- with(mort_imputed_tcon,
rma(yi = lrr,
sei = lrr_se,
mods = ~ 0 + disturbance_type))
pool_mort_tcon <- summary(pool(mort_fit_tcon))
pool_mort_tcon[-1] <- round(pool_mort_tcon[-1], digits = 3)
pool_mort_tcon
table_gen(pool_mort_tcon, "biome_tcon_mort.csv")
data[data$Olson_Biome == "Temperate Broadleaf and Mixed Forests" & data$carbon_vs_mortality == 2,]
mort_imputed_tbro <- impute_data(data[data$Olson_Biome == "Temperate Broadleaf and Mixed Forests" & data$carbon_vs_mortality == 2,], m = 100)
mort_fit_tbro <- with(mort_imputed_tbro,
rma(yi = lrr,
sei = lrr_se,
mods = ~ 0 + disturbance_type))
pool_mort_tbro <- summary(pool(mort_fit_tbro))
pool_mort_tbro[-1] <- round(pool_mort_tbro[-1], digits = 3)
pool_mort_tbro
table_gen(pool_mort_tbro, "biome_tbro_mort.csv")
mort_imputed_med <- impute_data(data[data$Olson_Biome == "Mediterranean Forests, Woodlands and Scrub" & data$carbon_vs_mortality == 2,], m = 100)
mort_fit_med <- with(mort_imputed_med,
rma(yi = lrr,
sei = lrr_se,
mods = ~ 0 + disturbance_type))
pool_mort_med <- summary(pool(mort_fit_med))
pool_mort_med[-1] <- round(pool_mort_med[-1], digits = 3)
pool_mort_med
table_gen(pool_mort_med, "biome_med_mort.csv")
data$disturbance_type <- factor(data$disturbance_type, levels = c("fire", "drought", "insect"))
A <- ggplot(data[data$carbon_vs_mortality == 2, ]) +
geom_bar(aes(x = Olson_Biome, fill = disturbance_type)) +
labs(x = "Biome", y = "Count", fill = "Disturbance") +
annotate("text", x = "Deserts and Xeric Shrublands", y = 10, label = "Deserts and \n Xeric Shrublands", size = 4) +
annotate("text", x = "Mediterranean Forests, Woodlands and Scrub", y = 13, label = "Mediterranean Forests, \n Woodlands and Scrub", size = 4) +
annotate("text", x = "Temperate Broadleaf and Mixed Forests", y = 17, label = "Temperate Broadleaf \n and Mixed Forests", size = 4) +
annotate("text", x = "Temperate Conifer Forests", y = 105, label = "Temperate Conifer \n Forests", size = 4) +
ggtitle("Biome Effects: Survivorship") +
scale_fill_manual(values = c(red, yellow, blue)) +
scale_y_continuous(expand = c(0,0), limits = c(0, 110)) +
theme_bw() +
theme(legend.position = "inside", legend.position.inside = c(0.1, 0.9), axis.text.x = element_blank(),
plot.title = element_text(face = "bold", size = 18))
A
unique(data$Olson_Biome)
mort_imputed_des <- impute_data(data[data$Olson_Biome == "Deserts and Xeric Shrublands" & data$carbon_vs_mortality == 2,], m = 100)
mort_fit_des <- with(mort_imputed_des,
rma(yi = lrr,
sei = lrr_se,
mods = ~ 0 + disturbance_type))
pool_mort_des <- summary(pool(mort_fit_des))
pool_mort_des[-1] <- round(pool_mort_des[-1], digits = 3)
pool_mort_des
pool_mort_tcon
data[data$Olson_Biome == "Deserts and Xeric Shrublands" & data$carbon_vs_mortality == 2,c("lrr", "disturbance_type")]
mort_imputed_des <- impute_data(data[data$Olson_Biome == "Deserts and Xeric Shrublands" & data$carbon_vs_mortality == 2,], m = 100)
mort_fit_des <- with(mort_imputed_des,
rma(yi = lrr,
sei = lrr_se,
mods = ~ 0 + disturbance_type))
pool_mort_des <- summary(pool(mort_fit_des))
pool_mort_des[-1] <- round(pool_mort_des[-1], digits = 3)
pool_mort_des
pool_mort_med
mort_imputed_des <- impute_data(data[data$Olson_Biome == "Deserts and Xeric Shrublands" & data$carbon_vs_mortality == 2,], m = 100)
mort_fit_des <- with(mort_imputed_des,
rma(yi = lrr,
sei = lrr_se,
mods = ~ 0 + disturbance_type))
data[data$Olson_Biome == "Deserts and Xeric Shrublands" & data$carbon_vs_mortality == 2,c("lrr", "disturbance_type")]
data[data$Olson_Biome == "Deserts and Xeric Shrublands" & data$carbon_vs_mortality == 2,c("lrr","lrr_se", "disturbance_type")]
data[data$Olson_Biome == "Deserts and Xeric Shrublands" & data$carbon_vs_mortality == 2,c("lrr","lrr_se","studyID", "disturbance_type")]
mort_imputed_des <- impute_data(data[data$Olson_Biome == "Deserts and Xeric Shrublands" & data$carbon_vs_mortality == 2,], m = 100)
mort_fit_des <- with(mort_imputed_des,
rma(yi = lrr,
sei = lrr_se,
mods = ~ 0 + disturbance_type))
pool_mort_des <- summary(pool(mort_fit_des))
pool_mort_des[-1] <- round(pool_mort_des[-1], digits = 3)
pool_mort_des
mort_imputed_des <- impute_data(data[data$Olson_Biome == "Deserts and Xeric Shrublands" & data$carbon_vs_mortality == 2,], m = 100)
data[data$Olson_Biome == "Deserts and Xeric Shrublands" & data$carbon_vs_mortality == 2,c("lrr","lrr_se","studyID", "disturbance_type")]
mort_imputed_des$imp
